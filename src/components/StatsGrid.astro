---
// src/components/StatsGrid.astro
---

<section class="bg-white dark:bg-gray-900">
  <div class="max-w-screen-xl px-4 py-8 mx-auto text-center lg:py-16 lg:px-6">
      <dl class="grid max-w-screen-md gap-8 mx-auto text-gray-900 sm:grid-cols-2 dark:text-white">
          <div class="flex flex-col items-center justify-center">
              <dt class="mb-2 text-3xl md:text-4xl font-extrabold">
                <span class="stat-value" data-value="9">0</span>
              </dt>
              <dd class="font-light text-gray-500 dark:text-gray-400">Projects Completed</dd>
          </div>
          <div class="flex flex-col items-center justify-center">
              <dt class="mb-2 text-3xl md:text-4xl font-extrabold">
                <span class="stat-value" data-value="10">0</span>
              </dt>
              <dd class="font-light text-gray-500 dark:text-gray-400">Ongoing Projects</dd>
          </div>
          <div class="flex flex-col items-center justify-center">
              <dt class="mb-2 text-3xl md:text-4xl font-extrabold">
                <span class="stat-value" data-value="87.8">0</span>
              </dt>
              <dd class="font-light text-gray-500 dark:text-gray-400">Ton CO2</dd>
          </div>
          <div class="flex flex-col items-center justify-center">
              <dt class="mb-2 text-3xl md:text-4xl font-extrabold">
                <span class="stat-value" data-value="18747985">0</span>
              </dt>
              <dd class="font-light text-gray-500 dark:text-gray-400">kWh</dd>
          </div>
      </dl>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const statValues = document.querySelectorAll('.stat-value');

    const animateValue = (element: Element, start: number, end: number, duration: number) => {
      let startTimestamp: number | null = null;
      const step = (timestamp: number | null) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        element.textContent = Math.floor(progress * (end - start) + start).toLocaleString();
        if (progress < 1) {
          window.requestAnimationFrame(step);
        }
      };
      window.requestAnimationFrame(step);
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const element = entry.target;
          const value = parseFloat(element.getAttribute('data-value'));
          animateValue(element, 0, value, 2000);
          observer.unobserve(element);
        }
      });
    }, {
      threshold: 0.5
    });

    statValues.forEach(value => {
      observer.observe(value);
    });
  });
</script>